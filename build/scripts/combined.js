function addCommas(e){e+="";for(var t=e.split("."),s=t[0],a=t.length>1?"."+t[1]:"",o=/(\d+)(\d{3})/;o.test(s);)s=s.replace(o,"$1,$2");return s+a}var allLayers=[{groupHeading:"some layers",showGroupHeading:!0,includeInLayerList:!0,layers:{}},{groupHeading:"some other layers",showGroupHeading:!0,includeInLayerList:!0,layers:{"Pt Feature Layer":{url:"http://wim.usgs.gov/arcgis/rest/services/BadRiverDataPortal/NWIS_Sites/MapServer/0",options:{id:"ptFeatureLayer",visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0}},"FIM Sites":{url:"http://fimlb-1071089098.us-east-1.elb.amazonaws.com/arcgis/rest/services/FIMMapper/sites/MapServer/0",options:{opacity:.75,visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0}}}},{groupHeading:"exclusive group",showGroupHeading:!0,includeInLayerList:!0,layers:{"Cat 2":{url:"http://olga.er.usgs.gov/stpgis/rest/services/Vulnerability/NACCH_change_probabilities/MapServer",options:{id:"cat2",layers:[13,14,15],opacity:1},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,exclusiveGroupName:"Coastal Erosion Hazard",visible:!1}},"Cat 1":{url:"http://olga.er.usgs.gov/stpgis/rest/services/Vulnerability/NACCH_change_probabilities/MapServer",options:{id:"cat1",layers:[5,6,7],opacity:1},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,exclusiveGroupName:"Coastal Erosion Hazard",visible:!0}}}},{groupHeading:"other map servers",showGroupHeading:!0,includeInLayerList:!0,layers:{Wetlands:{url:"http://107.20.228.18/ArcGIS/rest/services/Wetlands/MapServer",options:{opacity:.75,visible:!0},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,zoomScale:144448}},"NAWQA networks":{url:"http://wimsharedlb-418672833.us-east-1.elb.amazonaws.com/arcgis/rest/services/NAWQA/tablesTest/MapServer",options:{layers:[1],visible:!0,opacity:.6},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0}}}}],fev=fev||{data:{events:[],eventTypes:[],states:[],counties:[],sensorTypes:[],sensorStatusTypes:[],collectionConditions:[],deploymentTypes:[],hwmTypes:[],hwmQualities:[]},globals:{csvQueryURL:"",jsonQueryURL:"",xmlQueryURL:"",jsonSensorsURLRoot:"",xmlSensorsURLRoot:"",csvSensorsURLRoot:"",sensorsQueryString:"",jsonHWMsURLRoot:"",xmlHWMsURLRoot:"",csvHWMsURLRoot:"",hwmsQueryString:"",xmlPeaksURLRoot:"",jsonPeaksURLRoot:"",csvPeaksURLRoot:"",peaksQueryString:""}};$(document).ready(function(){"use strict";function e(){$("#geosearchModal").modal("show")}function t(){$("#aboutModal").modal("show")}function s(){$("#filtersModal").modal("show")}function a(e){l&&r.removeLayer(l),l=L.esri.basemapLayer(e),r.addLayer(l),n&&r.removeLayer(n),("ShadedRelief"===e||"Oceans"===e||"Gray"===e||"DarkGray"===e||"Imagery"===e||"Terrain"===e)&&(n=L.esri.basemapLayer(e+"Labels"),r.addLayer(n))}function o(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}}var n,r=L.map("mapDiv").setView([39.833333,-98.583333],4),l=L.esri.basemapLayer("Gray").addTo(r);$("#mapDiv").height($("body").height()),r.invalidateSize(),$(".dataTypeRadio").each(function(){$(this).on("click",function(){var e=$(this).attr("id"),t=$("#"+e+"Form");t.show(),$(".hiddenForm").not(t).hide()})}),$(".check").on("click",function(){$(this).find("span").toggle()}),$("#geosearchNav").click(function(){e()}),$("#aboutNav").click(function(){t()}),$("#btnFilters").click(function(){s()}),$("#btnFilter").on("click",function(){buildQueryStrings()});$(".basemapBtn").on("click",function(){var e=this.id.replace("btn","");switch(e){case"Streets":e="Streets";break;case"Satellite":e="Imagery";break;case"Topo":e="Topographic";break;case"Terrain":e="ShadedRelief";break;case"Gray":e="Gray";break;case"NatGeo":e="NationalGeographic"}a(e)}),$("#legendButtonNavBar, #legendButtonSidebar").on("click",function(){$("#legend").toggle()}),$("#legendClose").on("click",function(){$("#legend").hide()}),r.whenReady(function(){var e=o(r.getZoom());$("#scale")[0].innerHTML=e,console.log("Initial Map scale registered as "+e,r.getZoom());var t=r.getCenter();$("#latitude").html(t.lat.toFixed(4)),$("#longitude").html(t.lng.toFixed(4))}),r.on("zoomend",function(){var e=r.getZoom(),t=o(e);$("#scale")[0].innerHTML=t}),r.on("mousemove",function(e){$("#mapCenterLabel").css("display","none"),null!==e.latlng&&($("#latitude").html(e.latlng.lat.toFixed(4)),$("#longitude").html(e.latlng.lng.toFixed(4)))}),r.on("dragend",function(){$("#mapCenterLabel").css("display","inline");var e=r.getCenter();$("#latitude").html(e.lat.toFixed(4)),$("#longitude").html(e.lng.toFixed(4))})}),$(document).ready(function(){$("#evtTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/eventtypes.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var s=e.TYPE,a=t.TYPE;return a>s?-1:s>a?1:0});for(var t=0;t<e.length;t++)$("#evtTypeSelect").append("<option value='"+e[t].event_type_id+"'>"+e[t].type+"</option>"),fev.data.eventTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#evtSelect").select2({placeholder:"All Events"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/events.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var s=e.event_name,a=t.event_name;return a>s?-1:s>a?1:0});for(var t=0;t<e.length;t++)$("#evtSelect").append("<option value='"+e[t].event_id+"'>"+e[t].event_name+"</option>"),e[t].id=e[t].event_id,fev.data.events.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#stateSelect").select2({placeholder:"All Events"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/Sites/States.json",headers:{Accept:"*/*"},success:function(t){t.sort(function(e,t){var s=e.state_name,a=t.state_name;return a>s?-1:s>a?1:0});for(var s=0;s<t.length;s++)$("#stateSelect").append("<option value='"+t[s].state_abbrev+"'>"+t[s].state_name+"</option>"),t[s].id=t[s],fev.data.states.push(t[s]);e()},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#countySelect").select2({placeholder:"All Counties"}),$("#countySelect").on("select2:select select2:unselect",function(e){}),$("#sensorTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/sensortypes.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var s=e.TYPE,a=t.TYPE;return a>s?-1:s>a?1:0});for(var t=0;t<e.length;t++)$("#sensorTypeSelect").append("<option value='"+e[t].sensor_type_id+"'>"+e[t].sensor+"</option>"),fev.data.sensorTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#sensorTypeSelect").on("select2:select select2:unselect",function(e){for(var t,s=$(this).val(),a=[],o=0;o<s.length;o++)t=fev.data.sensorTypes.filter(function(e){return e.sensor_type_id==s[o]}),a.push(t[0].sensor);var n=a.join();console.log("Selected sensor type(s) are: "+n),$("#sensorTypeDisplay").html(n)}),$("#sensorStatusSelect").select2({placeholder:"All Statuses"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/statustypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#sensorStatusSelect").append("<option value='"+e[t].status_type_id+"'>"+e[t].status+"</option>"),fev.data.sensorStatusTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#sensorStatusSelect").on("select2:select select2:unselect",function(e){for(var t,s=$(this).val(),a=[],o=0;o<s.length;o++)t=fev.data.sensorStatusTypes.filter(function(e){return e.status_type_id==s[o]}),a.push(t[0].status);var n=a.join();console.log("Selected sensor status(s) are: "+n),$("#sensorStatusDisplay").html(n)}),$("#collectionConditionSelect").select2({placeholder:"All Conditions"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/InstrCollectConditions.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#collectionConditionSelect").append("<option value='"+e[t].id+"'>"+e[t].condition+"</option>"),fev.data.collectionConditions.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#collectionConditionSelect").on("select2:select select2:unselect",function(e){for(var t,s=$(this).val(),a=[],o=0;o<s.length;o++)t=fev.data.collectionConditions.filter(function(e){return e.id==s[o]}),a.push(t[0].condition);var n=a.join();console.log("Selected collect condition(s) are: "+n),$("#collectConditionDisplay").html(n)}),$("#deployTypeSelect").select2({placeholder:"All Deploy Types"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/deploymenttypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#deployTypeSelect").append("<option value='"+e[t].deployment_type_id+"'>"+e[t].method+"</option>"),fev.data.deploymentTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#deployTypeSelect").on("select2:select select2:unselect",function(e){for(var t,s=$(this).val(),a=[],o=0;o<s.length;o++)t=fev.data.deploymentTypes.filter(function(e){return e.deployment_type_id==s[o]}),a.push(t[0].method);var n=a.join();console.log("Selected deploy type(s) are: "+n),$("#deployTypeDisplay").html(n)}),$("#hwmTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/hwmtypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#hwmTypeSelect").append("<option value='"+e[t].hwm_type_id+"'>"+e[t].hwm_type+"</option>"),e[t].id=e[t].hwm_type_id,fev.data.hwmTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#hwmTypeSelect").on("select2:select select2:unselect",function(e){for(var t,s=$(this).val(),a=[],o=0;o<s.length;o++)t=fev.data.hwmTypes.filter(function(e){return e.hwm_type_id==s[o]}),a.push(t[0].hwm_type);var n=a.join();console.log("Selected hwm type(s) are: "+n),$("#hwmTypeDisplay").html(n)}),$("#hwmQualitySelect").select2({placeholder:"All Qualities"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/hwmqualities.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#hwmQualitySelect").append("<option value='"+e[t].hwm_quality_id+"'>"+e[t].hwm_quality+"</option>"),e[t].id=e[t].hwm_quality_id,fev.data.hwmQualities.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#hwmQualitySelect").on("select2:select select2:unselect",function(e){for(var t,s=$(this).val(),a=[],o=0;o<s.length;o++)t=fev.data.hwmQualities.filter(function(e){return e.hwm_quality_id==s[o]}),a.push(t[0].hwm_quality);var n=a.join();console.log("Selected hwm type(s) are: "+n),$("#hwmQualityDisplay").html(n)});var e=function(){for(var e=0;e<fev.data.states.length;e++)$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/Sites/CountiesByState.json?StateAbbrev="+fev.data.states[e].state_abbrev,headers:{Accept:"*/*"},currentState:fev.data.states[e].state_abbrev,success:function(e){fev.data.counties[this.currentState]=e},error:function(e){console.log("Error retrieving counties. The error is: "+e)}});setTimeout(function(){console.log(fev.data.counties)},300)};$("#evtTypeSelect").on("select2:select select2:unselect",function(e){var t=$(this).val();if(null!==t)if(t.length>0){for(var s=[],a=0;a<t.length;a++)s.push(Number(t[a]));var o=fev.data.events.filter(function(e){return s.indexOf(e.event_type_id)>-1});$("#evtSelect").html("");for(var n=0;n<o.length;n++)$("#evtSelect").append("<option value='"+o[n].event_id+"'>"+o[n].event_name+"</option>")}else{$("#evtSelect").html("");for(var a=0;a<fev.data.events.length;a++)$("#evtSelect").append("<option value='"+fev.data.events[a].event_id+"'>"+fev.data.events[a].event_name+"</option>")}for(var r,l=[],a=0;a<t.length;a++)r=fev.data.eventTypes.filter(function(e){return e.event_type_id==t[a]}),l.push(r[0].type);var i=l.join();console.log("Selected event type(s) are: "+i),$("#eventTypeDisplay").html(i)}),$("#evtSelect").on("change",function(e){var t=$(this).val();if(t.length>0){for(var s=function(e){for(var t=[],s=0;s<e.length;s++)-1==t.indexOf(e[s])&&t.push(e[s]);return t},a=[],o=0;o<t.length;o++)a.push(parseInt(t[o]));for(var n=[],o=0;o<fev.data.events.length;o++)-1!=a.indexOf(fev.data.events[o].event_id)&&n.push(fev.data.events[o].event_type_id);for(var r=s(n),l=document.getElementById("evtTypeSelect").options,o=0;o<l.length;o++)l[o].disabled=!0,-1!=r.indexOf(parseInt(l[o].value))&&(l[o].disabled=!1)}else for(var i=document.getElementById("evtTypeSelect").options,o=0;o<i.length;o++)i[o].disabled=!1}),$("#stateSelect").on("select2:select select2:unselect",function(e){var t=$(this).val();if(!t>0||null==t)return $("#countySelect").html(""),void $("#countySelect").append("<option value=null>Please select state(s) first </option>");var s=[];for(var a in fev.data.counties)for(var o=0;o<fev.data.counties[a].length;o++){var n=fev.data.counties[a][o].county_name;t.indexOf(a)>-1&&(s=s.concat(n))}$("#countySelect").html("");for(var a in s){var r=s[a];$("#countySelect").append("<option value='"+r+"'>"+r+"</option>")}for(var l,i=[],o=0;o<t.length;o++)l=fev.data.states.filter(function(e){return e.state_abbrev==t[o]}),i.push(l[0].state_name);var c=i.join();console.log("Selected states(s) are: "+c),$("#stateDisplay").html(c)})});var buildQueryStrings=function(){var e="";if(null!==$("#evtTypeSelect").val()){var t=$("#evtTypeSelect").val();e=t.toString()}var s="";if(null!==$("#evtSelect").val()){var a=$("#evtSelect").val();s=a.toString()}var o=[];$("#active")[0].checked&&!$("#complete")[0].checked&&o.push(1),$("#complete")[0].checked&&!$("#active")[0].checked&&o.push(2),($("#active")[0].checked&&$("#complete")[0].checked||!$("#active")[0].checked&&!$("#complete")[0].checked)&&o.push(0);var n=o.toString(),r="";if(null!==$("#stateSelect").val()){var l=$("#stateSelect").val();r=l.toString()}var i="";if(null!==$("#countySelect").val()){var c=$("#countySelect").val();i=c.toString()}if($("#sensorRad")[0].checked){var u="";if(null!==$("#sensorTypeSelect").val()){var p=$("#sensorTypeSelect").val();u=p.toString()}var v="";if(null!==$("#sensorStatusSelect").val()){var d=$("#sensorStatusSelect").val();v=d.toString()}var y="";if(null!==$("#collectionConditionSelect").val()){var h=$("#collectionConditionSelect").val();y=h.toString()}var g="";if(null!==$("#deployTypeSelect").val()){var S=$("#deployTypeSelect").val();g=S.toString()}stnDataPortal.globals.xmlSensorsURLRoot="http://stn.wim.usgs.gov/STNServices/Instruments",stnDataPortal.globals.jsonSensorsURLRoot="http://stn.wim.usgs.gov/STNServices/Instruments.json",stnDataPortal.globals.csvSensorsURLRoot="http://stn.wim.usgs.gov/STNServices/Instruments.csv",stnDataPortal.globals.sensorsQueryString="?Event="+s+"&EventType="+e+"&EventStatus="+n+"&States="+r+"&County="+i+"&CurrentStatus="+v+"&CollectionCondition="+y+"&DeploymentType="+g,stnDataPortal.globals.csvQueryURL=stnDataPortal.globals.csvSensorsURLRoot+stnDataPortal.globals.sensorsQueryString,stnDataPortal.globals.jsonQueryURL=stnDataPortal.globals.jsonSensorsURLRoot+stnDataPortal.globals.sensorsQueryString,stnDataPortal.globals.xmlQueryURL=stnDataPortal.globals.xmlSensorsURLRoot+stnDataPortal.globals.sensorsQueryString}if($("#hwmRad")[0].checked){var m="";if(null!==$("#hwmTypeSelect").val()){var f=$("#hwmTypeSelect").val();m=f.toString()}var T="";if(null!==$("#hwmQualitySelect").val()){var b=$("#hwmQualitySelect").val();T=b.toString()}var w=[];$("#coastal")[0].checked&&!$("#riverine")[0].checked&&w.push("Coastal"),$("#riverine")[0].checked&&!$("#coastal")[0].checked&&w.push("Riverine");var L=w.toString(),R=[];$("#surveyCompleteYes")[0].checked&&!$("#surveyCompleteNo")[0].checked&&R.push("true"),$("#surveyCompleteNo")[0].checked&&!$("#surveyCompleteYes")[0].checked&&R.push("false");var k=R.toString(),D=[];$("#stillWaterYes")[0].checked&&!$("#stillWaterNo")[0].checked&&D.push("true"),$("#stillWaterNo")[0].checked&&!$("#stillWaterYes")[0].checked&&D.push("false");var P=D.toString();stnDataPortal.globals.xmlHWMsURLRoot="http://stn.wim.usgs.gov/STNServices/HWMs/FilteredHWMs",stnDataPortal.globals.jsonHWMsURLRoot="http://stn.wim.usgs.gov/STNServices/HWMs/FilteredHWMs.json",stnDataPortal.globals.csvHWMsURLRoot="http://stn.wim.usgs.gov/STNServices/HWMs/FilteredHWMs.csv",stnDataPortal.globals.hwmsQueryString="?Event="+s+"&EventType="+e+"&EventStatus="+n+"&States="+r+"&County="+i+"&HWMType="+m+"&HWMQuality="+T+"&HWMEnvironment="+L+"&SurveyComplete="+k+"&StillWater="+P,stnDataPortal.globals.csvQueryURL=stnDataPortal.globals.csvHWMsURLRoot+stnDataPortal.globals.hwmsQueryString,stnDataPortal.globals.jsonQueryURL=stnDataPortal.globals.jsonHWMsURLRoot+stnDataPortal.globals.hwmsQueryString,stnDataPortal.globals.xmlQueryURL=stnDataPortal.globals.xmlHWMsURLRoot+stnDataPortal.globals.hwmsQueryString}if($("#peakRad")[0].checked){var _;""!==$("#peakStartDate").value&&(_=$("#peakStartDate")[0].value);var j;""!==$("#peakEndDate").value&&(j=$("#peakEndDate")[0].value),stnDataPortal.globals.xmlPeaksURLRoot="http://stn.wim.usgs.gov/STNServices/PeakSummaries/FilteredPeaks",stnDataPortal.globals.jsonPeaksURLRoot="http://stn.wim.usgs.gov/STNServices/PeakSummaries/FilteredPeaks.json",stnDataPortal.globals.csvPeaksURLRoot="http://stn.wim.usgs.gov/STNServices/PeakSummaries/FilteredPeaks.csv",stnDataPortal.globals.peaksQueryString="?Event="+s+"&EventType="+e+"&EventStatus="+n+"&States="+r+"&County="+i+"&StartDate="+_+"&EndDate="+j,stnDataPortal.globals.csvQueryURL=stnDataPortal.globals.csvPeaksURLRoot+stnDataPortal.globals.peaksQueryString,stnDataPortal.globals.jsonQueryURL=stnDataPortal.globals.jsonPeaksURLRoot+stnDataPortal.globals.peaksQueryString,stnDataPortal.globals.xmlQueryURL=stnDataPortal.globals.xmlPeaksURLRoot+stnDataPortal.globals.peaksQueryString}};