function displaySensorGeoJSON(type,url,markerIcon){var currentSubGroup=eval(type);currentSubGroup.clearLayers();var currentMarker=L.geoJson(!1,{pointToLayer:function(e,t){markerCoords.push(t);var r=L.marker(t,{icon:markerIcon});return r},onEachFeature:function(e,t){oms.addMarker(t);var r=$("#largeEventNameDisplay").html(),a='<table class="table table-hover table-striped table-condensed"><caption class="popup-title">'+getLayerName(type)+" for "+r+'</caption><tr><td><strong>STN Site Name: </strong></td><td><span id="siteName">'+e.properties.site_name+'</span></td></tr><tr><td><strong>Status: </strong></td><td><span id="status">'+e.properties.status+'</span></td></tr><tr><td><strong>City: </strong></td><td><span id="city">'+(""==e.properties.city||null==e.properties.city||void 0==e.properties.city?"<i>No city recorded</i>":e.properties.city)+'</span></td></tr><tr><td><strong>County: </strong></td><td><span id="county">'+e.properties.county+'</span></td></tr><tr><td><strong>State: </strong></td><td><span id="state">'+e.properties.state+'</span></td></tr><tr><td><strong>Latitude, Longitude (DD): </strong></td><td><span class="latLng">'+e.properties.latitude_dd.toFixed(4)+", "+e.properties.longitude_dd.toFixed(4)+'</span></td></tr><tr><td><strong>Full data link: </strong></td><td><span id="sensorDataLink"><b><a target="blank" href='+sensorPageURLRoot+e.properties.site_id+"&Sensor="+e.properties.instrument_id+">Sensor data page</a></b></span></td></tr></table>";if("rdg"==type){var s;$.getJSON(stnServicesURL+"/Sites/"+e.properties.site_id+".json",function(e){if(""!==e.usgs_sid){s=e.usgs_sid;var r='<div id="rdgChartDiv"><label for="rdgChartDiv">Water level elevation (ft)</label><img width="350" src="http://waterdata.usgs.gov/nwisweb/graph?agency_cd=USGS&site_no='+s+'&parm_cd=62620&begin_date=2016-01-21&end_date=2016-01-28" alt="rapid deploy gage graph"></div>';t.bindPopup(a+r,{minWidth:350})}else{var r='<div id="rdgChartDiv"><label for="rdgChartDiv">Missing USGS Site ID. Unable to display RDG Real-time graph.</label></div>';t.bindPopup(a+r)}})}else t.bindPopup(a)}});$.getJSON(url,function(e){return 0==e.length?void console.log("0 "+markerIcon.options.className+" GeoJSON features found"):void(e.features.length>0&&(console.log(e.features.length+" "+markerIcon.options.className+" GeoJSON features found"),currentMarker.addData(e),currentMarker.eachLayer(function(e){e.addTo(currentSubGroup)})))})}function displayHWMGeoJSON(e,t){hwm.clearLayers();var r=L.geoJson(!1,{pointToLayer:function(e,r){markerCoords.push(r);var a=L.marker(r,{icon:t});return a},onEachFeature:function(e,t){oms.addMarker(t);var r=$("#largeEventNameDisplay").html(),a='<table class="table table-hover table-striped table-condensed"><caption class="popup-title">'+getLayerName("hwm")+" for "+r+'</caption><tr><td><strong>STN Site No.: </strong></td><td><span id="hwmSiteNo">'+e.properties.site_no+'</span></td></tr><tr><td><strong>Elevation(ft): </strong></td><td><span id="hwmElev">'+e.properties.elev_ft+'</span></td></tr><tr><td><strong>Datum: </strong></td><td><span id="hwmWaterbody">'+e.properties.verticalDatumName+'</span></td></tr><tr><td><strong>Height Above Ground: </strong></td><td><span id="hwmHtAboveGnd">'+(void 0!==e.properties.height_above_gnd?e.properties.height_above_gnd:"<i>No value recorded</i>")+'</span></td></tr><tr><td><strong>Approval status: </strong></td><td><span id="hwmStatus">'+(void 0==e.properties.approval_id||0==e.properties.approval_id?'Provisional  <button type="button" class="btn btn-sm data-disclaim"><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></button>':"Approved")+'</span></td></tr><tr><td><strong>Type: </strong></td><td><span id="hwmType"></span>'+e.properties.hwmTypeName+'</td></tr><tr><td><strong>Marker: </strong></td><td><span id="hwmMarker">'+e.properties.markerName+'</span></td></tr><tr><td><strong>Quality: </strong></td><td><span id="hwmQuality">'+e.properties.hwmQualityName+'</span></td></tr><tr><td><strong>Waterbody: </strong></td><td><span id="hwmWaterbody">'+e.properties.waterbody+'</span></td></tr><tr><td><strong>County: </strong></td><td><span id="hwmCounty">'+e.properties.countyName+'</span></td></tr><tr><td><strong>State: </strong></td><td><span id="hwmState">'+e.properties.stateName+'</span></td></tr><tr><td><strong>Latitude, Longitude (DD): </strong></td><td><span class="latLng">'+e.properties.latitude_dd.toFixed(4)+", "+e.properties.longitude_dd.toFixed(4)+'</span></td></tr><tr><td><strong>Description: </strong></td><td><span id="hwmDescription">'+e.properties.hwm_locationdescription+'</span></td></tr><tr><td><strong>Full data link: </strong></td><td><span id="sensorDataLink"><b><a target="blank" href='+hwmPageURLRoot+e.properties.site_id+"&HWM="+e.properties.hwm_id+">HWM data page</a></b></span></td></tr></table>";t.bindPopup(a),$(".data-disclaim").on("click",function(){$("#aboutModal").modal("show")})}});$.getJSON(e,function(e){return 0==e.length?void console.log("0 "+t.options.className+" GeoJSON features found"):void(e.features.length>0&&(console.log(e.features.length+" "+t.options.className+" GeoJSON features found"),r.addData(e),r.eachLayer(function(e){e.addTo(hwm)})))})}function displayPeaksGeoJSON(e,t){peaks.clearLayers();var r=L.geoJson(!1,{pointToLayer:function(e,r){markerCoords.push(r);var a=L.marker(r,{icon:t});return a},onEachFeature:function(e,t){oms.addMarker(t);var r=$("#largeEventNameDisplay").html(),a='<table class="table table-condensed table-striped table-hover"><caption class="popup-title">'+getLayerName("peaks")+" for "+r+"</caption><tr><th>Peak Stage (ft)</th><th>Datum</th><th>Peak Date & Time (UTC)</th></tr><tr><td>"+e.properties.peak_stage+"</td><td>"+e.properties.vdatum+"</td><td>"+e.properties.peak_date+"</td></tr></table>";t.bindPopup(a)}});$.getJSON(e,function(e){return 0==e.length?void console.log("0 "+t.options.className+" GeoJSON features found"):void(e.features.length>0&&(console.log(e.features.length+" "+t.options.className+" GeoJSON features found"),r.addData(e),r.eachLayer(function(e){e.addTo(peaks)})))})}function getLayerName(e){switch(e){case"baro":return"Barometric Pressure Sensor";case"stormTide":return"Storm Tide Sensor";case"met":return"Meteorlogical Sensor";case"rdg":return"Rapid Deployment Gage";case"hwm":return"High Water Mark";case"peaks":return"Peak Summary"}}function populateEventDates(e){for(var t=0;t<fev.data.events.length;t++)fev.data.events[t].event_id==e&&(fev.vars.currentEventStartDate_str=fev.data.events[t].event_start_date,console.log("Selected event START date is "+fev.vars.currentEventStartDate_str),fev.vars.currentEventEndDate_str=fev.data.events[t].event_end_date,console.log("Selected event END date is "+fev.vars.currentEventEndDate_str))}function filterMapData(e,t){markerCoords=[];var r="";if(t&&(r=e),null!==$("#evtSelect_welcomeModal").val()){var a=$("#evtSelect_welcomeModal").val();r=a.toString(),$("#eventNameDisplay").html($("#evtSelect_welcomeModal").select2("data").map(function(e){return e.text}).join(", ")),$("#largeEventNameDisplay").html($("#evtSelect_welcomeModal").select2("data").map(function(e){return e.text}).join(", ")),populateEventDates(r)}var s="";if(null!==$("#evtTypeSelect").val()){var o=$("#evtTypeSelect").val();s=o.toString(),$("#eventTypeDisplay").html($("#evtTypeSelect").select2("data").map(function(e){return e.text}).join(", "))}if(null!==$("#evtSelect_filterModal").val()){var a=$("#evtSelect_filterModal").val();r=a.toString(),$("#eventNameDisplay").html($("#evtSelect_filterModal").select2("data").map(function(e){return e.text}).join(", ")),$("#largeEventNameDisplay").html($("#evtSelect_filterModal").select2("data").map(function(e){return e.text}).join(", ")),populateEventDates(r)}var n=[];$("#active")[0].checked&&!$("#complete")[0].checked&&(n.push(1),$("#eventStatusDisplay").html("Active")),$("#complete")[0].checked&&!$("#active")[0].checked&&(n.push(2),$("#eventStatusDisplay").html("Complete")),$("#active")[0].checked&&$("#complete")[0].checked&&(n.push(0),$("#eventStatusDisplay").html("Active, Complete")),$("#active")[0].checked||$("#complete")[0].checked||(n.push(0),$("#eventStatusDisplay").html(""));var i=n.toString(),l="";if(null!==$("#stateSelect").val()){var c=$("#stateSelect").val();l=c.toString(),$("#stateDisplay").html(l)}var p="";if(null!==$("#countySelect").val()){var d=$("#countySelect").val();p=d.toString(),$("#countyDisplay").html(p)}var u="";if(null!==$("#sensorTypeSelect").val()){var v=$("#sensorTypeSelect").val();u=v.toString(),$("#sensorTypeDisplay").html($("#sensorTypeSelect").select2("data")[0].text)}var h="";if(null!==$("#sensorStatusSelect").val()){var m=$("#sensorStatusSelect").val();h=m.toString(),$("#sensorStatusDisplay").html($("#sensorStatusSelect").select2("data")[0].text)}var g="";if(null!==$("#collectionConditionSelect").val()){var y=$("#collectionConditionSelect").val();g=y.toString(),$("#collectConditionDisplay").html($("#collectionConditionSelect").select2("data")[0].text)}var S="";if(null!==$("#deployTypeSelect").val()){var f=$("#deployTypeSelect").val();S=f.toString(),$("#deployTypeDisplay").html($("#deployTypeSelect").select2("data")[0].text)}fev.queryStrings.sensorsQueryString="?Event="+r+"&EventType="+s+"&EventStatus="+i+"&States="+l+"&County="+p+"&SensorType="+u+"&CurrentStatus="+h+"&CollectionCondition="+g+"&DeploymentType="+S,fev.urls.csvSensorsQueryURL=fev.urls.csvSensorsURLRoot+fev.queryStrings.sensorsQueryString,fev.urls.jsonSensorsQueryURL=fev.urls.jsonSensorsURLRoot+fev.queryStrings.sensorsQueryString,fev.urls.xmlSensorsQueryURL=fev.urls.xmlSensorsURLRoot+fev.queryStrings.sensorsQueryString,$("#sensorDownloadButtonCSV").attr("href",fev.urls.csvSensorsQueryURL),$("#sensorDownloadButtonJSON").attr("href",fev.urls.jsonSensorsQueryURL),$("#sensorDownloadButtonXML").attr("href",fev.urls.xmlSensorsQueryURL),$.each(["baro","met","rdg","stormTide","waveHeight"],function(e,t){displaySensorGeoJSON(t,fev.urls[t+"GeoJSONViewURL"]+fev.queryStrings.sensorsQueryString,window[t+"MarkerIcon"])}),$(document).ajaxComplete(function(){markerCoords.length>0&&map.fitBounds(markerCoords)});var w="";if(null!==$("#hwmTypeSelect").val()){var L=$("#hwmTypeSelect").val();w=L.toString(),$("#hwmTypeDisplay").html($("#hwmTypeSelect").select2("data")[0].text)}var b="";if(null!==$("#hwmQualitySelect").val()){var T=$("#hwmQualitySelect").val();b=T.toString(),$("#hwmQualityDisplay").html($("#hwmQualitySelect").select2("data")[0].text)}var k=[];$("#coastal")[0].checked&&!$("#riverine")[0].checked&&(k.push("Coastal"),$("#hwmEnvDisplay").html("Coastal")),$("#riverine")[0].checked&&!$("#coastal")[0].checked&&(k.push("Riverine"),$("#hwmEnvDisplay").html("Riverine"));var N=k.toString(),R=[];$("#surveyCompleteYes")[0].checked&&!$("#surveyCompleteNo")[0].checked&&(R.push("true"),$("#hwmSurveyCompDisplay").html("True")),$("#surveyCompleteNo")[0].checked&&!$("#surveyCompleteYes")[0].checked&&(R.push("false"),$("#hwmSurveyCompDisplay").html("False"));var M=R.toString(),_=[];$("#stillWaterYes")[0].checked&&!$("#stillWaterNo")[0].checked&&(_.push("true"),$("#hwmStillWaterDisplay").html("True")),$("#stillWaterNo")[0].checked&&!$("#stillWaterYes")[0].checked&&(_.push("false"),$("#hwmStillWaterDisplay").html("False"));var D=_.toString();fev.queryStrings.hwmsQueryString="?Event="+r+"&EventType="+s+"&EventStatus="+i+"&States="+l+"&County="+p+"&HWMType="+w+"&HWMQuality="+b+"&HWMEnvironment="+N+"&SurveyComplete="+M+"&StillWater="+D,fev.urls.csvHWMsQueryURL=fev.urls.csvHWMsURLRoot+fev.queryStrings.hwmsQueryString,fev.urls.jsonHWMsQueryURL=fev.urls.jsonHWMsURLRoot+fev.queryStrings.hwmsQueryString,fev.urls.xmlHWMsQueryURL=fev.urls.xmlHWMsURLRoot+fev.queryStrings.hwmsQueryString,$("#hwmDownloadButtonCSV").attr("href",fev.urls.csvHWMsQueryURL),$("#hwmDownloadButtonJSON").attr("href",fev.urls.jsonHWMsQueryURL),$("#hwmDownloadButtonXML").attr("href",fev.urls.xmlHWMsQueryURL),displayHWMGeoJSON(fev.urls.hwmFilteredGeoJSONViewURL+fev.queryStrings.hwmsQueryString,hwmMarkerIcon);var U;""!==$("#peakStartDate").value&&(U=$("#peakStartDate")[0].value);var E;""!==$("#peakEndDate").value&&(E=$("#peakEndDate")[0].value),fev.queryStrings.peaksQueryString="?Event="+r+"&EventType="+s+"&EventStatus="+i+"&States="+l+"&County="+p+"&StartDate="+U+"&EndDate="+E,fev.urls.csvPeaksQueryURL=fev.urls.csvPeaksURLRoot+fev.queryStrings.peaksQueryString,fev.urls.jsonPeaksQueryURL=fev.urls.jsonPeaksURLRoot+fev.queryStrings.peaksQueryString,fev.urls.xmlPeaksQueryURL=fev.urls.xmlPeaksURLRoot+fev.queryStrings.peaksQueryString,$("#peaksDownloadButtonCSV").attr("href",fev.urls.csvPeaksQueryURL),$("#peaksDownloadButtonJSON").attr("href",fev.urls.jsonPeaksQueryURL),$("#peaksDownloadButtonXML").attr("href",fev.urls.xmlPeaksQueryURL),displayPeaksGeoJSON(fev.urls.peaksFilteredGeoJSONViewURL+fev.queryStrings.peaksQueryString,peaksMarkerIcon)}function addCommas(e){e+="";for(var t=e.split("."),r=t[0],a=t.length>1?"."+t[1]:"",s=/(\d+)(\d{3})/;s.test(r);)r=r.replace(s,"$1,$2");return r+a}var allLayers=[{groupHeading:"some layers",showGroupHeading:!0,includeInLayerList:!0,layers:{}},{groupHeading:"some other layers",showGroupHeading:!0,includeInLayerList:!0,layers:{"Pt Feature Layer":{url:"http://wim.usgs.gov/arcgis/rest/services/BadRiverDataPortal/NWIS_Sites/MapServer/0",options:{id:"ptFeatureLayer",visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0}},"FIM Sites":{url:"http://fimlb-1071089098.us-east-1.elb.amazonaws.com/arcgis/rest/services/FIMMapper/sites/MapServer/0",options:{opacity:.75,visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0}}}},{groupHeading:"exclusive group",showGroupHeading:!0,includeInLayerList:!0,layers:{"Cat 2":{url:"http://olga.er.usgs.gov/stpgis/rest/services/Vulnerability/NACCH_change_probabilities/MapServer",options:{id:"cat2",layers:[13,14,15],opacity:1},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,exclusiveGroupName:"Coastal Erosion Hazard",visible:!1}},"Cat 1":{url:"http://olga.er.usgs.gov/stpgis/rest/services/Vulnerability/NACCH_change_probabilities/MapServer",options:{id:"cat1",layers:[5,6,7],opacity:1},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,exclusiveGroupName:"Coastal Erosion Hazard",visible:!0}}}},{groupHeading:"other map servers",showGroupHeading:!0,includeInLayerList:!0,layers:{Wetlands:{url:"http://107.20.228.18/ArcGIS/rest/services/Wetlands/MapServer",options:{opacity:.75,visible:!0},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,zoomScale:144448}},"NAWQA networks":{url:"http://wimsharedlb-418672833.us-east-1.elb.amazonaws.com/arcgis/rest/services/NAWQA/tablesTest/MapServer",options:{layers:[1],visible:!0,opacity:.6},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0}}}}],stnServicesURL="http://stn.wim.usgs.gov/STNServices",stnServicesTestURL="http://stntest.wim.usgs.gov/STNServices2",sensorPageURLRoot="http://stn.wim.usgs.gov/STNPublicInfo/#/SensorPage?Site=",hwmPageURLRoot="http://stn.wim.usgs.gov/STNPublicInfo/#/HWMPage?Site=",fev=fev||{data:{events:[],eventTypes:[],states:[],counties:[],sensorTypes:[],sensorStatusTypes:[],collectionConditions:[],deploymentTypes:[],hwmTypes:[],hwmQualities:[]},urls:{jsonSensorsURLRoot:stnServicesURL+"/Instruments.json",xmlSensorsURLRoot:stnServicesURL+"/Instruments.xml",csvSensorsURLRoot:stnServicesURL+"/Instruments.csv",jsonHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.json",xmlHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.xml",csvHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.csv",hwmFilteredGeoJSONViewURL:stnServicesURL+"/HWMs/FilteredHWMs.geojson",hwmGeoJSONViewURL:stnServicesURL+"/hwms.geojson",xmlPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.xml",jsonPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.json",csvPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.csv",peaksFilteredGeoJSONViewURL:stnServicesURL+"/PeakSummaries/FilteredPeaks.geojson",baroGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=baro_view&",metGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=met_view&",rdgGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=rdg_view&",stormTideGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=stormtide_view&",waveHeightGeoJSONViewURL:stnServicesURL+"/SensorViews.geojson?ViewType=waveheight_view&"},queryStrings:{},vars:{currentEventStartDate_str:"",currentEventEndDate_str:""}},map,markerCoords=[],oms,baroMarkerIcon=L.divIcon({className:"baroMarker",iconAnchor:[8,24],popupAnchor:[0,0]}),metMarkerIcon=L.divIcon({className:"metMarker",iconAnchor:[8,24],popupAnchor:[0,0]}),rdgMarkerIcon=L.divIcon({className:"rdgMarker",iconAnchor:[8,24],popupAnchor:[0,0]}),stormTideMarkerIcon=L.divIcon({className:"stormTideMarker",iconAnchor:[8,24],popupAnchor:[0,0]}),waveHeightMarkerIcon=L.divIcon({className:"waveHeightMarker",iconAnchor:[8,24],popupAnchor:[0,0]}),hwmMarkerIcon=L.divIcon({className:"hwmMarker",iconAnchor:[8,24],popupAnchor:[0,0]}),peaksMarkerIcon=L.divIcon({className:"peaksMarker",iconAnchor:[8,24],popupAnchor:[0,0]}),baro=L.layerGroup(),stormTide=L.layerGroup(),met=L.layerGroup(),rdg=L.layerGroup(),waveHeight=L.layerGroup(),hwm=L.layerGroup(),peaks=L.layerGroup();$(document).ready(function(){"use strict";function e(e,t){$("#eventNameDisplay").html(e),$("#largeEventNameDisplay").html(e);var r=[t.toString()];$("#evtSelect_filterModal").val([r]).trigger("change")}function t(){$("#geosearchModal").modal("show")}function r(){$("#aboutModal").modal("show")}function a(){$("#filtersModal").modal("show")}function s(e){c&&map.removeLayer(c),c=L.esri.basemapLayer(e),map.addLayer(c),l&&map.removeLayer(l),("ShadedRelief"===e||"Oceans"===e||"Gray"===e||"DarkGray"===e||"Imagery"===e||"Terrain"===e)&&(l=L.esri.basemapLayer(e+"Labels"),map.addLayer(l))}function o(){search_api.on("load",function(){$("#chkExtent").change(function(){if($(this).is(":checked")){console.log("Checked",map.getBounds().getSouth(),map.getBounds().getNorth(),map.getBounds().getWest(),map.getBounds().getEast());var e=map.getBounds();search_api.setOpts({LATmin:e.getSouth(),LATmax:e.getNorth(),LONmin:e.getWest(),LONmax:e.getEast()})}}),search_api.setOpts({textboxPosition:"user-defined",theme:"user-defined",DbSearchIncludeUsgsSiteSW:!0,DbSearchIncludeUsgsSiteGW:!0,DbSearchIncludeUsgsSiteSP:!0,DbSearchIncludeUsgsSiteAT:!0,DbSearchIncludeUsgsSiteOT:!0}),search_api.on("location-found",function(e){var t=14;"U.S. State or Territory"===e.Category&&(t=9),map.setView([e.y,e.x],t),L.popup().setLatLng([e.y,e.x]).setContent("<p><b>"+e.label+"</b> <br/><br/><b>NAME:            </b> "+e.name+"<br/><b>CATEGORY:        </b> "+e.category+"<br/><b>STATE:           </b> "+e.state+"<br/><b>COUNTY:          </b> "+e.county+"<br/><br/><b>LATITUDE:        </b> "+e.y+"<br/><b>LONGITUDE:       </b> "+e.x+"<br/><b>ELEVATION (FEET):</b> "+e.elevFt+"<br/><br/><b>PERCENT MATCH:   </b> "+e.pctMatch+"<br/></p>").openOn(map)}),search_api.on("no-result",function(){console.error("No location matching the entered text could be found.")}),search_api.on("timeout",function(){console.error("The search operation timed out.")})}),$("#searchSubmit").on("click",function(){console.log("in search submit"),$("#sapi-searchTextBox").keyup()})}function n(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}}if($("#btnSubmitEvent").click(function(){if(null!==$("#evtSelect_welcomeModal").val()){$("#welcomeModal").modal("hide");var e=$("#evtSelect_welcomeModal").val();$("#evtSelect_filterModal").val([e]).trigger("change"),filterMapData(),populateEventDates(e)}else alert("Please choose an event to proceed.")}),window.location.hash){var i=window.location.hash.substring(1);$.getJSON("https://stn.wim.usgs.gov/STNServices/events/"+i+".json",{}).done(function(t){i=t.event_id,filterMapData(i,!0),e(t.event_name,t.event_id),populateEventDates(i)}).fail(function(){console.log("Request Failed. Most likely invalid event name.")})}else $("#welcomeModal").modal({backdrop:"static",keyboard:!1});map=L.map("mapDiv").setView([39.833333,-98.583333],4);var l,c=L.esri.basemapLayer("Gray").addTo(map);hwm.addTo(map);var p={"<i class='baroMarker'></i>&nbsp;Barometric Pressure Sensor":baro,"<i class='metMarker'></i>&nbsp;Meteorological Sensor":met,"<i class='rdgMarker'></i>&nbsp;Rapid Deployment Gage":rdg,"<i class='stormTideMarker'></i>&nbsp;Storm Tide Sensor":stormTide,"<i class='waveHeightMarker'></i>&nbsp;Wave Height Sensor":waveHeight},d=L.control.layers(null,p,{collapsed:!1});d.addTo(map),d._container.remove(),document.getElementById("sensorsToggleDiv").appendChild(d.onAdd(map));var u={"<i class='hwmMarker'></i>&nbsp;High Water Marks":hwm,"<i class='peaksMarker'></i>&nbsp;Peak Summaries":peaks},v=L.control.layers(null,u,{collapsed:!1});v.addTo(map),v._container.remove(),document.getElementById("observedToggleDiv").appendChild(v.onAdd(map)),oms=new OverlappingMarkerSpiderfier(map,{keepSpiderfied:!0}),$("#sensorDownloadButtonCSV").attr("href",fev.urls.csvSensorsURLRoot),$("#sensorDownloadButtonJSON").attr("href",fev.urls.jsonSensorsURLRoot),$("#sensorDownloadButtonXML").attr("href",fev.urls.xmlSensorsURLRoot),$("#hwmDownloadButtonCSV").attr("href",fev.urls.csvHWMsURLRoot),$("#hwmDownloadButtonJSON").attr("href",fev.urls.jsonHWMsURLRoot),$("#hwmDownloadButtonXML").attr("href",fev.urls.xmlHWMsURLRoot),$("#peaksDownloadButtonCSV").attr("href",fev.urls.csvPeaksURLRoot),$("#peaksDownloadButtonJSON").attr("href",fev.urls.jsonPeaksURLRoot),$("#peaksDownloadButtonXML").attr("href",fev.urls.xmlPeaksURLRoot),$(".dataTypeRadio").each(function(){$(this).on("click",function(){var e=$(this).attr("id"),t=$("#"+e+"Form");t.show(),$(".hiddenForm").not(t).hide()})}),$(".check").on("click",function(){$(this).find("span").toggle()}),$("#geosearchNav").click(function(){t()}),$("#aboutNav").click(function(){r()}),$("#btnChangeFilters").click(function(){a()}),$("#btnSubmitFilters").on("click",function(){filterMapData(),$("#filtersModal").modal("hide")}),$(".basemapBtn").on("click",function(){var e=this.id.replace("btn","");switch(e){case"Streets":e="Streets";break;case"Satellite":e="Imagery";break;case"Topo":e="Topographic";break;case"Terrain":e="ShadedRelief";break;case"Gray":e="Gray";break;case"NatGeo":e="NationalGeographic"}s(e)});var h=document.createElement("script");h.src="http://txpub.usgs.gov/DSS/search_api/1.1/api/search_api.min.js",h.onload=function(){o()},document.body.appendChild(h),$("#legendButtonNavBar, #legendButtonSidebar").on("click",function(){$("#legend").toggle()}),$("#legendClose").on("click",function(){$("#legend").hide()}),map.whenReady(function(){var e=n(map.getZoom());$("#scale")[0].innerHTML=e,console.log("Initial Map scale registered as "+e,map.getZoom());var t=map.getCenter();$("#latitude").html(t.lat.toFixed(4)),$("#longitude").html(t.lng.toFixed(4))}),map.on("zoomend",function(){var e=map.getZoom(),t=n(e);$("#scale")[0].innerHTML=t}),map.on("mousemove",function(e){$("#mapCenterLabel").css("display","none"),null!==e.latlng&&($("#latitude").html(e.latlng.lat.toFixed(4)),$("#longitude").html(e.latlng.lng.toFixed(4)))}),map.on("dragend",function(){$("#mapCenterLabel").css("display","inline");var e=map.getCenter();$("#latitude").html(e.lat.toFixed(4)),$("#longitude").html(e.lng.toFixed(4))})}),$(document).ready(function(){$("#btnClearFilters").click(function(){$(".clearable").val("").trigger("change")}),$("#evtTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/eventtypes.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var r=e.TYPE,a=t.TYPE;return a>r?-1:r>a?1:0});for(var t=0;t<e.length;t++)$("#evtTypeSelect").append('<option value="'+e[t].event_type_id+'">'+e[t].type+"</option>"),fev.data.eventTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$(".evtSelect").select2({placeholder:"Select event",allowClear:!1,maximumSelectionLength:1}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/events.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var r=e.event_name,a=t.event_name;return a>r?-1:r>a?1:0});for(var t=0;t<e.length;t++)$(".evtSelect").append('<option value="'+e[t].event_id+'">'+e[t].event_name+"</option>"),e[t].id=e[t].event_id,fev.data.events.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#stateSelect").select2({placeholder:"All Events"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/Sites/States.json",headers:{Accept:"*/*"},success:function(t){t.sort(function(e,t){var r=e.state_name,a=t.state_name;return a>r?-1:r>a?1:0});for(var r=0;r<t.length;r++)$("#stateSelect").append('<option value="'+t[r].state_abbrev+'">'+t[r].state_name+"</option>"),t[r].id=t[r],fev.data.states.push(t[r]);e()},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#countySelect").select2({placeholder:"All Counties"}),$("#countySelect").on("select2:select select2:unselect",function(e){}),$("#sensorTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/sensortypes.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var r=e.TYPE,a=t.TYPE;return a>r?-1:r>a?1:0});for(var t=0;t<e.length;t++)$("#sensorTypeSelect").append('<option value="'+e[t].sensor_type_id+'">'+e[t].sensor+"</option>"),fev.data.sensorTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#sensorStatusSelect").select2({placeholder:"All Statuses"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/statustypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#sensorStatusSelect").append('<option value="'+e[t].status_type_id+'">'+e[t].status+"</option>"),fev.data.sensorStatusTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#collectionConditionSelect").select2({placeholder:"All Conditions"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/InstrCollectConditions.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#collectionConditionSelect").append('<option value="'+e[t].id+'">'+e[t].condition+"</option>"),fev.data.collectionConditions.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#deployTypeSelect").select2({placeholder:"All Deploy Types"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/deploymenttypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#deployTypeSelect").append('<option value="'+e[t].deployment_type_id+'">'+e[t].method+"</option>"),fev.data.deploymentTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#hwmTypeSelect").select2({placeholder:"All Types"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/hwmtypes.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#hwmTypeSelect").append('<option value="'+e[t].hwm_type_id+'">'+e[t].hwm_type+"</option>"),e[t].id=e[t].hwm_type_id,fev.data.hwmTypes.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#hwmQualitySelect").select2({placeholder:"All Qualities"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/hwmqualities.json",headers:{Accept:"*/*"},success:function(e){for(var t=0;t<e.length;t++)$("#hwmQualitySelect").append('<option value="'+e[t].hwm_quality_id+'">'+e[t].hwm_quality+"</option>"),e[t].id=e[t].hwm_quality_id,fev.data.hwmQualities.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}});var e=function(){for(var e=0;e<fev.data.states.length;e++)$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/Sites/CountiesByState.json?StateAbbrev="+fev.data.states[e].state_abbrev,headers:{Accept:"*/*"},currentState:fev.data.states[e].state_abbrev,success:function(e){fev.data.counties[this.currentState]=e},error:function(e){console.log("Error retrieving counties. The error is: "+e)}});setTimeout(function(){console.log(fev.data.counties)},300)};$("#evtTypeSelect").on("select2:select select2:unselect",function(e){var t=$(this).val();if(null!==t)if(t.length>0){for(var r=[],a=0;a<t.length;a++)r.push(Number(t[a]));var s=fev.data.events.filter(function(e){return r.indexOf(e.event_type_id)>-1});$(".evtSelect").html("");for(var o=0;o<s.length;o++)$(".evtSelect").append('<option value="'+s[o].event_id+'">'+s[o].event_name+"</option>")}else{$(".evtSelect").html("");for(var a=0;a<fev.data.events.length;a++)$(".evtSelect").append('<option value="'+fev.data.events[a].event_id+'">'+fev.data.events[a].event_name+"</option>")}}),$(".evtSelect").on("change",function(e){var t=$(this).val();if(null===t);else{if(!(t.length>0)){for(var r=document.getElementById("evtTypeSelect").options,a=0;a<r.length;a++)r[a].disabled=!1;return}for(var s=function(e){for(var t=[],r=0;r<e.length;r++)-1===t.indexOf(e[r])&&t.push(e[r]);return t},o=[],a=0;a<t.length;a++)o.push(parseInt(t[a]));for(var n=[],a=0;a<fev.data.events.length;a++)-1!==o.indexOf(fev.data.events[a].event_id)&&n.push(fev.data.events[a].event_type_id);for(var i=s(n),l=document.getElementById("evtTypeSelect").options,a=0;a<l.length;a++)l[a].disabled=!0,-1!==i.indexOf(parseInt(l[a].value))&&(l[a].disabled=!1)}}),$("#stateSelect").on("select2:select select2:unselect",function(e){var t=$(this).val();if(!t>0||null===t)return $("#countySelect").html(""),void $("#countySelect").append("<option value=null>Please select state(s) first </option>");var r=[];for(var a in fev.data.counties)for(var s=0;s<fev.data.counties[a].length;s++){var o=fev.data.counties[a][s].county_name;t.indexOf(a)>-1&&(r=r.concat(o))}$("#countySelect").html("");for(var a in r){var n=r[a];$("#countySelect").append('<option value="'+n+'">'+n+"</option>")}})});