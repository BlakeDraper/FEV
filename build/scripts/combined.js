function addCommas(e){e+="";for(var t=e.split("."),s=t[0],r=t.length>1?"."+t[1]:"",n=/(\d+)(\d{3})/;n.test(s);)s=s.replace(n,"$1,$2");return s+r}var allLayers=[{groupHeading:"some layers",showGroupHeading:!0,includeInLayerList:!0,layers:{}},{groupHeading:"some other layers",showGroupHeading:!0,includeInLayerList:!0,layers:{"Pt Feature Layer":{url:"http://wim.usgs.gov/arcgis/rest/services/BadRiverDataPortal/NWIS_Sites/MapServer/0",options:{id:"ptFeatureLayer",visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0}},"FIM Sites":{url:"http://fimlb-1071089098.us-east-1.elb.amazonaws.com/arcgis/rest/services/FIMMapper/sites/MapServer/0",options:{opacity:.75,visible:!0},wimOptions:{type:"layer",layerType:"agisFeature",includeInLayerList:!0}}}},{groupHeading:"exclusive group",showGroupHeading:!0,includeInLayerList:!0,layers:{"Cat 2":{url:"http://olga.er.usgs.gov/stpgis/rest/services/Vulnerability/NACCH_change_probabilities/MapServer",options:{id:"cat2",layers:[13,14,15],opacity:1},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,exclusiveGroupName:"Coastal Erosion Hazard",visible:!1}},"Cat 1":{url:"http://olga.er.usgs.gov/stpgis/rest/services/Vulnerability/NACCH_change_probabilities/MapServer",options:{id:"cat1",layers:[5,6,7],opacity:1},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,exclusiveGroupName:"Coastal Erosion Hazard",visible:!0}}}},{groupHeading:"other map servers",showGroupHeading:!0,includeInLayerList:!0,layers:{Wetlands:{url:"http://107.20.228.18/ArcGIS/rest/services/Wetlands/MapServer",options:{opacity:.75,visible:!0},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0,zoomScale:144448}},"NAWQA networks":{url:"http://wimsharedlb-418672833.us-east-1.elb.amazonaws.com/arcgis/rest/services/NAWQA/tablesTest/MapServer",options:{layers:[1],visible:!0,opacity:.6},wimOptions:{type:"layer",layerType:"agisDynamic",includeInLayerList:!0}}}}],stnServicesURL="http://stn.wim.usgs.gov/STNServices",fev=fev||{data:{events:[],eventTypes:[],states:[],counties:[],sensorTypes:[],sensorStatusTypes:[],collectionConditions:[],deploymentTypes:[],hwmTypes:[],hwmQualities:[]},urls:{jsonSensorsURLRoot:stnServicesURL+"/Instruments.json",xmlSensorsURLRoot:stnServicesURL+"/Instruments.xml",csvSensorsURLRoot:stnServicesURL+"/Instruments.csv",jsonHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.json",xmlHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.xml",csvHWMsURLRoot:stnServicesURL+"/HWMs/FilteredHWMs.csv",xmlPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.xml",jsonPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.json",csvPeaksURLRoot:stnServicesURL+"/PeakSummaries/FilteredPeaks.csv",baroGeoJSONViewURL:"http://stntest.wim.usgs.gov/STNServices2/SensorViews.geojson?ViewType=baro_view&",metGeoJSONViewURL:"http://stntest.wim.usgs.gov/STNServices2/SensorViews.geojson?ViewType=met_view&",rdgGeoJSONViewURL:"http://stntest.wim.usgs.gov/STNServices2/SensorViews.geojson?ViewType=rdg_view&",stormTideGeoJSONViewURL:"http://stntest.wim.usgs.gov/STNServices2/SensorViews.geojson?ViewType=stormtide_view&",waveHeightGeoJSONViewURL:"http://stntest.wim.usgs.gov/STNServices2/SensorViews.geojson?ViewType=waveheight_view&"},queryStrings:{}},map;$(document).ready(function(){"use strict";function e(){$("#geosearchModal").modal("show")}function t(){$("#aboutModal").modal("show")}function s(){$("#filtersModal").modal("show")}function r(e){o&&map.removeLayer(o),o=L.esri.basemapLayer(e),map.addLayer(o),a&&map.removeLayer(a),("ShadedRelief"===e||"Oceans"===e||"Gray"===e||"DarkGray"===e||"Imagery"===e||"Terrain"===e)&&(a=L.esri.basemapLayer(e+"Labels"),map.addLayer(a))}function n(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}}map=L.map("mapDiv").setView([39.833333,-98.583333],4);var a,o=L.esri.basemapLayer("Gray").addTo(map);$("#mapDiv").height($("body").height()),map.invalidateSize(),$(".dataTypeRadio").each(function(){$(this).on("click",function(){var e=$(this).attr("id"),t=$("#"+e+"Form");t.show(),$(".hiddenForm").not(t).hide()})}),$(".check").on("click",function(){$(this).find("span").toggle()}),$("#geosearchNav").click(function(){e()}),$("#aboutNav").click(function(){t()}),$("#btnFilters").click(function(){s()}),$("#btnFilter").on("click",function(){buildQueryStrings()});$(".basemapBtn").on("click",function(){var e=this.id.replace("btn","");switch(e){case"Streets":e="Streets";break;case"Satellite":e="Imagery";break;case"Topo":e="Topographic";break;case"Terrain":e="ShadedRelief";break;case"Gray":e="Gray";break;case"NatGeo":e="NationalGeographic"}r(e)}),$("#legendButtonNavBar, #legendButtonSidebar").on("click",function(){$("#legend").toggle()}),$("#legendClose").on("click",function(){$("#legend").hide()}),map.whenReady(function(){var e=n(map.getZoom());$("#scale")[0].innerHTML=e,console.log("Initial Map scale registered as "+e,map.getZoom());var t=map.getCenter();$("#latitude").html(t.lat.toFixed(4)),$("#longitude").html(t.lng.toFixed(4))}),map.on("zoomend",function(){var e=map.getZoom(),t=n(e);$("#scale")[0].innerHTML=t}),map.on("mousemove",function(e){$("#mapCenterLabel").css("display","none"),null!==e.latlng&&($("#latitude").html(e.latlng.lat.toFixed(4)),$("#longitude").html(e.latlng.lng.toFixed(4)))}),map.on("dragend",function(){$("#mapCenterLabel").css("display","inline");var e=map.getCenter();$("#latitude").html(e.lat.toFixed(4)),$("#longitude").html(e.lng.toFixed(4))})}),$(document).ready(function(){$("#evtTypeSelect").select2({placeholder:"All Types",ajax:{dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/eventtypes.json",headers:{Accept:"*/*"},cache:!1,processResults:function(e){for(var t=0;t<e.length;t++)fev.data.eventTypes.push(e[t]);return{results:$.map(e,function(e){return{id:e.event_type_id,text:e.type}})}},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}}),$("#evtSelect").select2({placeholder:"All Events"}),$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/events.json",headers:{Accept:"*/*"},success:function(e){e.sort(function(e,t){var s=e.event_name,r=t.event_name;return r>s?-1:s>r?1:0});for(var t=0;t<e.length;t++)$("#evtSelect").append("<option value='"+e[t].event_id+"'>"+e[t].event_name+"</option>"),e[t].id=e[t].event_id,fev.data.events.push(e[t])},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}),$("#stateSelect").select2({placeholder:"All States",ajax:{dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/Sites/States.json",headers:{Accept:"*/*"},processResults:function(t){for(var s=0;s<t.length;s++)fev.data.states.push(t[s]);return e(),{results:$.map(t,function(e){return{id:e.state_abbrev,text:e.state_name}})}},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}}),$("#countySelect").select2({placeholder:"All Counties"}),$("#countySelect").on("select2:select select2:unselect",function(e){console.log("Selected counties are: "+$("#countySelect").val())}),$("#sensorTypeSelect").select2({placeholder:"All Types",ajax:{dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/sensortypes.json",headers:{Accept:"*/*"},processResults:function(e){for(var t=0;t<e.length;t++)fev.data.sensorTypes.push(e[t]);return{results:$.map(e,function(e){return{id:e.sensor_type_id,text:e.sensor}})}},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}}),$("#sensorStatusSelect").select2({placeholder:"All Statuses",ajax:{dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/statustypes.json",headers:{Accept:"*/*"},processResults:function(e){for(var t=0;t<e.length;t++)fev.data.sensorStatusTypes.push(e[t]);return{results:$.map(e,function(e){return{id:e.status_type_id,text:e.status}})}},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}}),$("#collectionConditionSelect").select2({placeholder:"All Conditions",ajax:{dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/InstrCollectConditions.json",headers:{Accept:"*/*"},processResults:function(e){for(var t=0;t<e.length;t++)fev.data.collectionConditions.push(e[t]);return{results:$.map(e,function(e){return{id:e.id,text:e.condition}})}},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}}),$("#deployTypeSelect").select2({placeholder:"All Deploy Types",ajax:{dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/deploymenttypes.json",headers:{Accept:"*/*"},processResults:function(e){for(var t=0;t<e.length;t++)fev.data.deploymentTypes.push(e[t]);return{results:$.map(e,function(e){return{id:e.deployment_type_id,text:e.method}})}},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}}),$("#hwmTypeSelect").select2({placeholder:"All Types",ajax:{dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/hwmtypes.json",headers:{Accept:"*/*"},processResults:function(e){for(var t=0;t<e.length;t++)fev.data.hwmTypes.push(e[t]);return{results:$.map(e,function(e){return{id:e.hwm_type_id,text:e.hwm_type}})}},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}}),$("#hwmQualitySelect").select2({placeholder:"All Qualities",ajax:{dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/hwmqualities.json",headers:{Accept:"*/*"},processResults:function(e){for(var t=0;t<e.length;t++)fev.data.hwmQualities.push(e[t]);return{results:$.map(e,function(e){return{id:e.hwm_quality_id,text:e.hwm_quality}})}},error:function(e){console.log("Error processing the JSON. The error is:"+e)}}});var e=function(){for(var e=0;e<fev.data.states.length;e++)$.ajax({dataType:"json",type:"GET",url:"http://stn.wim.usgs.gov/STNServices/Sites/CountiesByState.json?StateAbbrev="+fev.data.states[e].state_abbrev,headers:{Accept:"*/*"},currentState:fev.data.states[e].state_abbrev,success:function(e){fev.data.counties[this.currentState]=e},error:function(e){console.log("Error retrieving counties. The error is: "+e)}});setTimeout(function(){console.log(fev.data.counties)},300)};$("#evtTypeSelect").on("select2:select select2:unselect",function(e){var t=$(this).val();if(null!==t)if(t.length>0){for(var s=[],r=0;r<t.length;r++)s.push(Number(t[r]));var n=fev.data.events.filter(function(e){return s.indexOf(e.event_type_id)>-1});$("#evtSelect").html("");for(var a=0;a<n.length;a++)$("#evtSelect").append("<option value='"+n[a].event_id+"'>"+n[a].event_name+"</option>")}else{$("#evtSelect").html("");for(var r=0;r<fev.data.events.length;r++)$("#evtSelect").append("<option value='"+fev.data.events[r].event_id+"'>"+fev.data.events[r].event_name+"</option>")}}),$("#evtSelect").on("change",function(e){var t=$(this).val();if(t.length>0){for(var s=function(e){for(var t=[],s=0;s<e.length;s++)-1==t.indexOf(e[s])&&t.push(e[s]);return t},r=[],n=0;n<t.length;n++)r.push(parseInt(t[n]));for(var a=[],n=0;n<fev.data.events.length;n++)-1!=r.indexOf(fev.data.events[n].event_id)&&a.push(fev.data.events[n].event_type_id);for(var o=s(a),l=document.getElementById("evtTypeSelect").options,n=0;n<l.length;n++)l[n].disabled=!0,-1!=o.indexOf(parseInt(l[n].value))&&(l[n].disabled=!1)}else for(var i=document.getElementById("evtTypeSelect").options,n=0;n<i.length;n++)i[n].disabled=!1}),$("#stateSelect").on("select2:select select2:unselect",function(e){var t=$(this).val();if(!t>0||null==t)return $("#countySelect").html(""),void $("#countySelect").append("<option value=null>Please select state(s) first </option>");var s=[];for(var r in fev.data.counties)for(var n=0;n<fev.data.counties[r].length;n++){var a=fev.data.counties[r][n].county_name;t.indexOf(r)>-1&&(s=s.concat(a))}$("#countySelect").html("");for(var r in s){var o=s[r];$("#countySelect").append("<option value='"+o+"'>"+o+"</option>")}})});var buildQueryStrings=function(){var e="";if(null!==$("#evtTypeSelect").val()){var t=$("#evtTypeSelect").val();e=t.toString(),$("#eventTypeDisplay").html($("#evtTypeSelect").select2("data").map(function(e){return e.text}).join(", "))}var s="";if(null!==$("#evtSelect").val()){var r=$("#evtSelect").val();s=r.toString(),$("#eventNameDisplay").html($("#evtSelect").select2("data").map(function(e){return e.text}).join(", "))}var n=[];$("#active")[0].checked&&!$("#complete")[0].checked&&(n.push(1),$("#eventStatusDisplay").html("Active")),$("#complete")[0].checked&&!$("#active")[0].checked&&(n.push(2),$("#eventStatusDisplay").html("Complete")),$("#active")[0].checked&&$("#complete")[0].checked&&(n.push(0),$("#eventStatusDisplay").html("Active, Complete")),$("#active")[0].checked||$("#complete")[0].checked||(n.push(0),$("#eventStatusDisplay").html(""));var a=n.toString(),o="";if(null!==$("#stateSelect").val()){var l=$("#stateSelect").val();o=l.toString(),$("#stateDisplay").html(o)}var i="";if(null!==$("#countySelect").val()){var c=$("#countySelect").val();i=c.toString(),$("#countyDisplay").html(i)}if($("#sensorRad")[0].checked){var u="";if(null!==$("#sensorTypeSelect").val()){var p=$("#sensorTypeSelect").val();u=p.toString(),$("#sensorTypeDisplay").html($("#sensorTypeSelect").select2("data")[0].text)}var v="";if(null!==$("#sensorStatusSelect").val()){var d=$("#sensorStatusSelect").val();v=d.toString(),$("#sensorStatusDisplay").html($("#sensorStatusSelect").select2("data")[0].text)}var y="";if(null!==$("#collectionConditionSelect").val()){var h=$("#collectionConditionSelect").val();y=h.toString(),$("#collectConditionDisplay").html($("#collectionConditionSelect").select2("data")[0].text)}var S="";if(null!==$("#deployTypeSelect").val()){var m=$("#deployTypeSelect").val();S=m.toString(),$("#deployTypeDisplay").html($("#deployTypeSelect").select2("data")[0].text)}fev.queryStrings.sensorsQueryString="?Event="+s+"&EventType="+e+"&EventStatus="+a+"&States="+o+"&County="+i+"&SensorType="+u+"&CurrentStatus="+v+"&CollectionCondition="+y+"&DeploymentType="+S,fev.urls.csvSensorsQueryURL=fev.urls.csvSensorsURLRoot+fev.queryStrings.sensorsQueryString,fev.urls.jsonSensorsQueryURL=fev.urls.jsonSensorsURLRoot+fev.queryStrings.sensorsQueryString,fev.urls.xmlSensorsQueryURL=fev.urls.xmlSensorsURLRoot+fev.queryStrings.sensorsQueryString,$("#sensorDownloadButtons").append('<a href="'+fev.urls.csvSensorsQueryURL+'" class="btn btn-info" role="button">Download Sensors CSV</a>'),$("#sensorDownloadButtons").append('<a href="'+fev.urls.jsonSensorsQueryURL+'" class="btn btn-info" role="button">Download Sensors JSON</a>'),$("#sensorDownloadButtons").append('<a href="'+fev.urls.xmlSensorsQueryURL+'" class="btn btn-info" role="button">Download Sensors XML</a>');(new L.geoJson).addTo(map),(new L.geoJson).addTo(map),(new L.geoJson).addTo(map),(new L.geoJson).addTo(map),$.ajax({dataType:"json",url:fev.urls.stormTideGeoJSONViewURL+fev.queryStrings.sensorsQueryString,success:function(e){$(e.features).each(function(e,t){new L.geoJson(t,{pointToLayer:function(e,t){return L.circleMarker(t,{radius:4,fillColor:"#FF0000",color:"#000",weight:1,opacity:1,fillOpacity:.8})}}).addTo(map)})}}).error(function(){})}if($("#hwmRad")[0].checked){var f="";if(null!==$("#hwmTypeSelect").val()){var g=$("#hwmTypeSelect").val();f=g.toString(),$("#hwmTypeDisplay").html($("#hwmTypeSelect").select2("data")[0].text)}var T="";if(null!==$("#hwmQualitySelect").val()){var w=$("#hwmQualitySelect").val();T=w.toString(),$("#hwmQualityDisplay").html($("#hwmQualitySelect").select2("data")[0].text)}var R=[];$("#coastal")[0].checked&&!$("#riverine")[0].checked&&(R.push("Coastal"),$("#hwmEnvDisplay").html("Coastal")),$("#riverine")[0].checked&&!$("#coastal")[0].checked&&(R.push("Riverine"),$("#hwmEnvDisplay").html("Riverine"));var b=R.toString(),k=[];$("#surveyCompleteYes")[0].checked&&!$("#surveyCompleteNo")[0].checked&&(k.push("true"),$("#hwmSurveyCompDisplay").html("True")),$("#surveyCompleteNo")[0].checked&&!$("#surveyCompleteYes")[0].checked&&(k.push("false"),$("#hwmSurveyCompDisplay").html("False"));var x=k.toString(),j=[];$("#stillWaterYes")[0].checked&&!$("#stillWaterNo")[0].checked&&(j.push("true"),$("#hwmStillWaterDisplay").html("True")),$("#stillWaterNo")[0].checked&&!$("#stillWaterYes")[0].checked&&(j.push("false"),$("#hwmStillWaterDisplay").html("False"));var D=j.toString();fev.queryStrings.hwmsQueryString="?Event="+s+"&EventType="+e+"&EventStatus="+a+"&States="+o+"&County="+i+"&HWMType="+f+"&HWMQuality="+T+"&HWMEnvironment="+b+"&SurveyComplete="+x+"&StillWater="+D,fev.urls.csvHWMsQueryURL=fev.urls.csvHWMsURLRoot+fev.queryStrings.hwmsQueryString,fev.urls.jsonHWMsQueryURL=fev.urls.jsonHWMsURLRoot+fev.queryStrings.hwmsQueryString,fev.urls.xmlHWMsQueryURL=fev.urls.xmlHWMsURLRoot+fev.queryStrings.hwmsQueryString,$("#hwmDownloadButtons").append('<a href="'+fev.urls.csvHWMsQueryURL+'" class="btn btn-info" role="button">Download HWM CSV</a>'),$("#hwmDownloadButtons").append('<a href="'+fev.urls.jsonHWMsQueryURL+'" class="btn btn-info" role="button">Download HWM JSON</a>'),$("#hwmDownloadButtons").append('<a href="'+fev.urls.xmlHWMsQueryURL+'" class="btn btn-info" role="button">Download HWM XML</a>')}if($("#peakRad")[0].checked){var N;""!==$("#peakStartDate").value&&(N=$("#peakStartDate")[0].value);var U;""!==$("#peakEndDate").value&&(U=$("#peakEndDate")[0].value),fev.queryStrings.peaksQueryString="?Event="+s+"&EventType="+e+"&EventStatus="+a+"&States="+o+"&County="+i+"&StartDate="+N+"&EndDate="+U,fev.urls.csvPeaksQueryURL=fev.urls.csvPeaksURLRoot+fev.queryStrings.peaksQueryString,fev.urls.jsonPeaksQueryURL=fev.urls.jsonPeaksURLRoot+fev.queryStrings.peaksQueryString,fev.urls.xmlPeaksQueryURL=fev.urls.xmlPeaksURLRoot+fev.queryStrings.peaksQueryString,$("#peaksDownloadButtons").append('<a href="'+fev.urls.csvPeaksQueryURL+'" class="btn btn-info" role="button">Download HWM CSV</a>'),$("#peaksDownloadButtons").append('<a href="'+fev.urls.jsonPeaksQueryURL+'" class="btn btn-info" role="button">Download HWM JSON</a>'),$("#peaksDownloadButtons").append('<a href="'+fev.urls.xmlPeaksQueryURL+'" class="btn btn-info" role="button">Download HWM XML</a>')}};